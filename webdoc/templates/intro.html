<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>บทคัดย่อและกิตติกรรมประกาศ</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{% url 'index' %}">ระบบจัดการเอกสาร</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'cover' %}">หน้าปก</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                            href="{% url 'intro_view' %}">บทคัดย่อ/กิตติกรรมประกาศ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">เกี่ยวกับ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">ออกจากระบบ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
                {% endfor %}
        </ul>
        {% endif %}

        <h1 class="mb-4">จัดการบทคัดย่อและกิตติกรรมประกาศ</h1>

        <form id="myForm" method="post" action="{% url 'intro_view' %}">
            {% csrf_token %}

            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h4>ข้อมูลเอกสาร</h4>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="id_project_name_th" class="form-label">ชื่อปริญญานิพนธ์ (ภาษาไทย)</label>
                            <input type="text" class="form-control" id="id_project_name_th" name="project_name_th"
                                value="{{ initial.project_name_th|default:'' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="id_project_name_en" class="form-label">ชื่อปริญญานิพนธ์ (ภาษาอังกฤษ)</label>
                            <input type="text" class="form-control" id="id_project_name_en" name="project_name_en"
                                value="{{ initial.project_name_en|default:'' }}">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="id_major_th" class="form-label">สาขาวิชา (ภาษาไทย)</label>
                            <input type="text" class="form-control" id="id_major_th" name="major_th"
                                value="{{ initial.major_th|default:'' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="id_major_en" class="form-label">สาขาวิชา (ภาษาอังกฤษ)</label>
                            <input type="text" class="form-control" id="id_major_en" name="major_en"
                                value="{{ initial.major_en|default:'' }}">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="id_academic_year_th" class="form-label">ปีการศึกษา (พ.ศ.)</label>
                            <input type="number" class="form-control" id="id_academic_year_th" name="academic_year_th"
                                value="{{ initial.academic_year_th|default:'' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="id_academic_year_en" class="form-label">ปีการศึกษา (ค.ศ.)</label>
                            <input type="number" class="form-control" id="id_academic_year_en" name="academic_year_en"
                                value="{{ initial.academic_year_en|default:'' }}">
                        </div>
                    </div>

                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h4>บทคัดย่อ</h4>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="id_abstract_th_para1" class="form-label">บทคัดย่อ (ย่อหน้าแรก ภาษาไทย)</label>
                        <textarea class="form-control clean-textarea" id="id_abstract_th_para1" name="abstract_th_para1"
                            rows="5">{{ initial.abstract_th_para1|default:'' }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="id_abstract_th_para2" class="form-label">บทคัดย่อ (ย่อหน้าที่สอง ภาษาไทย)</label>
                        <textarea class="form-control clean-textarea" id="id_abstract_th_para2" name="abstract_th_para2"
                            rows="5">{{ initial.abstract_th_para2|default:'' }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="id_abstract_en_para1" class="form-label">บทคัดย่อ (ย่อหน้าแรก ภาษาอังกฤษ)</label>
                        <textarea class="form-control clean-textarea" id="id_abstract_en_para1" name="abstract_en_para1"
                            rows="5">{{ initial.abstract_en_para1|default:'' }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="id_abstract_en_para2" class="form-label">บทคัดย่อ (ย่อหน้าที่สอง ภาษาอังกฤษ)</label>
                        <textarea class="form-control clean-textarea" id="id_abstract_en_para2" name="abstract_en_para2"
                            rows="5">{{ initial.abstract_en_para2|default:'' }}</textarea>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="id_keyword_th" class="form-label">คำสำคัญ (ภาษาไทย)</label>
                            <input type="text" class="form-control" id="id_keyword_th" name="keyword_th"
                                value="{{ initial.keyword_th|default:'' }}"
                                placeholder="เช่น AI, Machine Learning, ...">
                        </div>
                        <div class="col-md-6">
                            <label for="id_keyword_en" class="form-label">คำสำคัญ (ภาษาอังกฤษ)</label>
                            <input type="text" class="form-control" id="id_keyword_en" name="keyword_en"
                                value="{{ initial.keyword_en|default:'' }}"
                                placeholder="เช่น AI, Machine Learning, ...">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h4>ข้อมูลผู้จัดทำ</h4>
                </div>
                <div class="card-body">
                    <div id="author_fields">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="id_author1_th" class="form-label">ผู้จัดทำคนที่ 1 (ภาษาไทย)</label>
                                <input type="text" class="form-control" id="id_author1_th" name="author1_th"
                                    value="{{ initial.author1_th|default:'' }}">
                            </div>
                            <div class="col-md-6">
                                <label for="id_author1_en" class="form-label">ผู้จัดทำคนที่ 1 (ภาษาอังกฤษ)</label>
                                <input type="text" class="form-control" id="id_author1_en" name="author1_en"
                                    value="{{ initial.author1_en|default:'' }}">
                            </div>
                        </div>
                        <div id="author2_block"
                            class="{% if not initial.author2_th and not initial.author2_en %}d-none{% endif %}">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="id_author2_th" class="form-label">ผู้จัดทำคนที่ 2 (ภาษาไทย)</label>
                                    <input type="text" class="form-control" id="id_author2_th" name="author2_th"
                                        value="{{ initial.author2_th|default:'' }}">
                                </div>
                                <div class="col-md-6">
                                    <label for="id_author2_en" class="form-label">ผู้จัดทำคนที่ 2 (ภาษาอังกฤษ)</label>
                                    <input type="text" class="form-control" id="id_author2_en" name="author2_en"
                                        value="{{ initial.author2_en|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline-info" id="toggleAuthor2Btn">
                        {% if initial.author2_th or initial.author2_en %}ลบผู้จัดทำคนที่ 2{% else %}เพิ่มผู้จัดทำคนที่
                        2{% endif %}
                    </button>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-warning text-dark">
                    <h4>ข้อมูลอาจารย์ที่ปรึกษา</h4>
                </div>
                <div class="card-body">
                    <div id="advisor_fields">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="id_advisor_th" class="form-label">อาจารย์ที่ปรึกษาคนที่ 1 (ภาษาไทย)</label>
                                <input type="text" class="form-control" id="id_advisor_th" name="advisor_th"
                                    value="{{ initial.advisor_th|default:'' }}">
                            </div>
                            <div class="col-md-6">
                                <label for="id_advisor_en" class="form-label">อาจารย์ที่ปรึกษาคนที่ 1
                                    (ภาษาอังกฤษ)</label>
                                <input type="text" class="form-control" id="id_advisor_en" name="advisor_en"
                                    value="{{ initial.advisor_en|default:'' }}">
                            </div>
                        </div>
                        <div id="coadvisor_block"
                            class="{% if not initial.coadvisor_th and not initial.coadvisor_en %}d-none{% endif %}">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="id_coadvisor_th" class="form-label">อาจารย์ที่ปรึกษาคนที่ 2
                                        (ภาษาไทย)</label>
                                    <input type="text" class="form-control" id="id_coadvisor_th" name="coadvisor_th"
                                        value="{{ initial.coadvisor_th|default:'' }}">
                                </div>
                                <div class="col-md-6">
                                    <label for="id_coadvisor_en" class="form-label">อาจารย์ที่ปรึกษาคนที่ 2
                                        (ภาษาอังกฤษ)</label>
                                    <input type="text" class="form-control" id="id_coadvisor_en" name="coadvisor_en"
                                        value="{{ initial.coadvisor_en|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline-warning" id="toggleAdvisor2Btn">
                        {% if initial.coadvisor_th or initial.coadvisor_en %}ลบอาจารย์ที่ปรึกษาคนที่ 2{% else
                        %}เพิ่มอาจารย์ที่ปรึกษาคนที่ 2{% endif %}
                    </button>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-secondary text-white">
                    <h4>กิตติกรรมประกาศ</h4>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="id_acknow_para1" class="form-label">ย่อหน้าแรกของกิตติกรรมประกาศ</label>
                        <textarea class="form-control clean-textarea" id="id_acknow_para1" name="acknow_para1"
                            rows="5">{{ initial.acknow_para1|default:'' }}</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="id_acknow_para2" class="form-label">ย่อหน้าที่สองของกิตติกรรมประกาศ</label>
                        <textarea class="form-control clean-textarea" id="id_acknow_para2" name="acknow_para2"
                            rows="5">{{ initial.acknow_para2|default:'' }}</textarea>
                    </div>
                    <div id="acknow_names_block">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="id_acknow_name1" class="form-label">ผู้จัดทำคนที่ 1 (ชื่อไทย)</label>
                                <input type="text" class="form-control" id="id_acknow_name1" name="acknow_name1"
                                    value="{{ initial.acknow_name1|default:'' }}">
                            </div>
                        </div>
                        <div id="acknow_name2_block" class="{% if not initial.acknow_name2 %}d-none{% endif %}">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="id_acknow_name2" class="form-label">ผู้จัดทำคนที่ 2 (ชื่อไทย)</label>
                                    <input type="text" class="form-control" id="id_acknow_name2" name="acknow_name2"
                                        value="{{ initial.acknow_name2|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline-secondary" id="toggleAcknowName2Btn">
                        {% if initial.acknow_name2 %}ลบผู้จัดทำคนที่ 2{% else %}เพิ่มผู้จัดทำคนที่ 2{% endif %}
                    </button>
                </div>
            </div>


            <div class="mt-4 mb-5 text-center">
                <button type="submit" name="action" value="save_intro"
                    class="btn btn-primary btn-lg me-2">บันทึกข้อมูล</button>
                <button type="submit" name="action" value="get_data_intro"
                    class="btn btn-info btn-lg me-2 text-white">ดึงข้อมูล</button>
                <button type="submit" name="action" value="generate_intro"
                    class="btn btn-success btn-lg">ดาวน์โหลด</button>
            </div>
        </form>
    </div>

    <script>

        // === CLEAN TEXTAREA ก่อน submit ===
        document.getElementById("myForm").addEventListener("submit", function (e) {
            const textareas = document.querySelectorAll(".clean-textarea");
            textareas.forEach(textarea => {
                const rawText = textarea.value;
                const cleanedText = rawText
                    .replace(/\r?\n/g, "")
                    .replace(/\s+/g, " ")
                    .trim();
                textarea.value = cleanedText;
            });
        });
    } else {
        console.log("Form with id 'myForm' not found."); // Debugging message
    }
});



        // JavaScript สำหรับผู้จัดทำ
        document.getElementById('toggleAuthor2Btn').addEventListener('click', function () {
            var author2Block = document.getElementById('author2_block');
            var inputAuthor2_th = document.getElementById('id_author2_th');
            var inputAuthor2_en = document.getElementById('id_author2_en');
            if (author2Block.classList.contains('d-none')) {
                author2Block.classList.remove('d-none');
                this.textContent = 'ลบผู้จัดทำคนที่ 2';
            } else {
                author2Block.classList.add('d-none');
                inputAuthor2_th.value = ''; // เคลียร์ค่าเมื่อซ่อน
                inputAuthor2_en.value = ''; // เคลียร์ค่าเมื่อซ่อน
                this.textContent = 'เพิ่มผู้จัดทำคนที่ 2';
            }
        });

        // JavaScript สำหรับอาจารย์ที่ปรึกษา
        document.getElementById('toggleAdvisor2Btn').addEventListener('click', function () {
            var coadvisorBlock = document.getElementById('coadvisor_block');
            var inputCoadvisor_th = document.getElementById('id_coadvisor_th');
            var inputCoadvisor_en = document.getElementById('id_coadvisor_en');
            if (coadvisorBlock.classList.contains('d-none')) {
                coadvisorBlock.classList.remove('d-none');
                this.textContent = 'ลบอาจารย์ที่ปรึกษาคนที่ 2';
            } else {
                coadvisorBlock.classList.add('d-none');
                inputCoadvisor_th.value = ''; // เคลียร์ค่าเมื่อซ่อน
                inputCoadvisor_en.value = ''; // เคลียร์ค่าเมื่อซ่อน
                this.textContent = 'เพิ่มอาจารย์ที่ปรึกษาคนที่ 2';
            }
        });

        // JavaScript สำหรับผู้ให้กิตติกรรมประกาศ
        document.getElementById('toggleAcknowName2Btn').addEventListener('click', function () {
            var acknowName2Block = document.getElementById('acknow_name2_block');
            var inputAcknowName2_th = document.getElementById('id_acknow_name2');
            if (acknowName2Block.classList.contains('d-none')) {
                acknowName2Block.classList.remove('d-none');
                this.textContent = 'ลบผู้จัดทำคนที่ 2';
            } else {
                acknowName2Block.classList.add('d-none');
                inputAcknowName2_th.value = ''; // เคลียร์ค่าเมื่อซ่อน
                this.textContent = 'เพิ่มผู้จัดทำคนที่ 2';
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eJq6dK4w"
        crossorigin="anonymous"></script>
</body>

</html>